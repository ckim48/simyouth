{# templates/scenario_step_static.html #}
{% extends "base.html" %}
{% block content %}

<style>
:root{
  --ink:#1a1515; --muted:#736b6b; --primary:#4a3b3b; --secondary:#967d7d;
  --accent:#e5dada; --bg:#f8f7f7; --edge:rgba(0,0,0,.08);
  --shadow-lg:0 20px 40px rgba(0,0,0,.06);
  --radius-md:16px;
}
.split-container{ display:grid; grid-template-columns:420px 1fr; min-height:100vh; }
.narrative-col{
  background:#fff; border-right:1px solid var(--edge); padding:2rem;
  height:100vh; position:sticky; top:0; overflow-y:auto; z-index:10;
}
.hero-img-wrap{ width:100%; border-radius:var(--radius-md); overflow:hidden; box-shadow:var(--shadow-lg); border:1px solid var(--edge); background:#fdfcfc; margin-bottom:1.5rem; }
.hero-img-wrap img{ width:100%; height:auto; display:block; }
.story-sofar{ background:#fafafa; padding:1.5rem; border-radius:var(--radius-md); border:1px solid var(--edge); }
.story-sofar h4{ font-size:.75rem; text-transform:uppercase; letter-spacing:.1em; color:var(--secondary); margin-bottom:.8rem; font-weight:800; }
.story-sofar p{ font-size:.95rem; color:var(--muted); line-height:1.6; margin:0; }
.interaction-col{ padding:4rem 10%; display:flex; flex-direction:column; align-items:center; }
.content-width{ width:100%; max-width:650px; }
.step-meta{ margin-bottom:2.5rem; }
.count{ font-size:.8rem; font-weight:800; text-transform:uppercase; color:var(--secondary); letter-spacing:.05em; }
.progress-track{ height:6px; background:#e8e3e3; border-radius:10px; margin-top:8px; overflow:hidden; }
.progress-fill{ height:100%; background:var(--secondary); transition:width .8s ease; }
.situation-box h1{ font-size:2.25rem; font-weight:850; color:var(--primary); letter-spacing:-.03em; margin-bottom:1rem; }
.situation-text{ font-size:1.15rem; line-height:1.7; color:#444; margin-bottom:2rem; }
.options-list{ display:flex; flex-direction:column; gap:1rem; }
.option-label{
  display:flex; gap:1.2rem; padding:1.5rem; border:2px solid transparent; background:#fff;
  border-radius:var(--radius-md); cursor:pointer; transition:all .2s ease; box-shadow:0 4px 12px rgba(0,0,0,.03);
}
.option-label:hover{ transform:translateX(8px); border-color:var(--accent); }
.option-label:has(input:checked){ border-color:var(--secondary); background:#fffcfc; }
.option-label input{ appearance:none; width:22px; height:22px; flex-shrink:0; border:2px solid #dcdcdc; border-radius:50%; margin-top:2px; }
.option-label input:checked{ background:var(--secondary); border-color:var(--secondary); box-shadow:inset 0 0 0 4px #fff; }
.btn-submit{ width:100%; margin-top:3rem; padding:1.25rem; border-radius:14px; background:var(--primary); color:#fff; border:none; font-weight:800; font-size:1.1rem; cursor:pointer; }
@media (max-width:1024px){
  .split-container{ grid-template-columns:1fr; }
  .narrative-col{ height:auto; position:relative; border-right:none; padding:1.5rem; }
}
</style>

<!--
IMG DEBUG:
mode={{ img_debug_mode }}
sid={{ sid }}
step_index={{ step_index }}
progress={{ img_debug_progress }}
hero_image={{ hero_image }}
candidates_tried={{ img_debug_candidates }}
-->

<div class="split-container">
  <aside class="narrative-col">

    {% if show_images %}
      <div class="hero-img-wrap">
        {% if hero_image %}
          <img src="{{ url_for('static', filename='scenarios/' ~ hero_image) }}" alt="Context">
        {% else %}
          <div style="padding:1rem; color:var(--muted); font-size:.9rem;">
            (No image found. Expected something like: static/scenarios/{{ sid|upper }}/step_{{ step_index }}_....png)
          </div>
        {% endif %}
      </div>
    {% endif %}

    <div class="story-sofar">
      <h4>Story So Far</h4>
      <p>{{ story_so_far or "Your journey begins..." }}</p>

      {% if prev_recap %}
      <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid var(--edge); font-size:.9rem;">
        <p style="margin:0;"><strong>Last choice:</strong> {{ prev_recap.chosen_label }}</p>
      </div>
      {% endif %}
    </div>
  </aside>

  <main class="interaction-col">
    <div class="content-width">
      <header class="step-meta">
        <span class="count">Step {{ step_index }} / {{ total_steps }}</span>
        <div class="progress-track">
          <div class="progress-fill" style="width: {{ (step_index / total_steps * 100) | round(0) }}%"></div>
        </div>
      </header>

      <section class="situation-box">
        <h1>{{ step.title }}</h1>
        <p class="situation-text">{{ situation_text }}</p>
      </section>

      <form method="post">
        <div class="options-list">
          {% for opt in step.options %}
            <label class="option-label">
              <input type="radio" name="choice" value="{{ opt.value }}"
                     {% if selected and selected == opt.value %}checked{% endif %}>
              <div>
                <p style="margin:0; font-weight:800;">{{ opt.label }}</p>
                <p style="margin:.35rem 0 0; color:var(--muted);">{{ opt.consequence }}</p>
              </div>
            </label>
          {% endfor %}
        </div>

        <button class="btn-submit" type="submit">
          {% if is_last %}Finish{% else %}Continue{% endif %}
        </button>
      </form>
    </div>
  </main>
</div>

{% endblock %}
